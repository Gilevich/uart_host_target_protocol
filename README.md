# STM32F411E Host-Target UART Communication

This project demonstrates a **bidirectional UART communication protocol** between a PC (host) and an STM32F411E-DISCO board (target).
It is implemented in **C++11** and uses a simple protocol with error detection and connection watchdog.

## Features

- Host communicates with target using **UART** (115200, 8N1, no flow control)
- Protocol includes:
  - Connection request/confirmation
  - Heartbeat (TICK_IND / TICK_CFM)
  - Button press notification
  - Disconnection
  - CRC-8 error detection
- Host monitors connection and handles timeouts
- Target handles LEDs and button events

## Target architecture

The STM32F411E-DISCO target implements the following behavior:

- Use TIM10 to increment internal time counter used to control LEDs blinking
- Button presses are handled in interrupt context
- UART TX and RX use callback functions
- UART RX is handled byte-by-byte
- Valid Rx frames are queued in rxQueue and processed in the main loop
- TX frames are queued in txQueue and processed in the main loop

## Host architecture

- Opens a serial port and initiates a connection
- Runs a dedicated RX thread
- Encodes and decodes protocol frames
- Implements a simple connection state machine
- Sends periodic tick indications
- Handles confirmations from the target

## Libraries

- STM32 HAL
- C++11 Standard Library
- Windows API

# Tools

- STM32CubeMX
- C++11
- CMake

## Build instruction

All commands should be executed from the project root directory

### Target (STM32F411VET)
The STM32 target uses STM32 HAL generated by STM32CubeMX.

The HAL sources are not included in the repository.
To regenerate them:

1. Open `target/target.ioc` in STM32CubeMX
2. Generate the project for CMake
3. Build and flash the firmware

cmake --build .\target\build\Debug\
STM32_Programmer_CLI -c port=SWD -w target/build/Debug/target.bin 0x08000000 -rst

Requirements:
  - CMake
  - STM32_Programmer_CLI
  - STM32F411E-DISCO board

### Host (Windows)
cmake --build .\host\build\
.\host\build\Debug\host.exe COM4 (Replace COM4 with your actual port that connected to target)

Requirements:
  - CMake
  - STM32_Programmer_CLI
  - STM32F411E-DISCO board

## Protocol

Each frame has the same following format:

| SOF | LEN | SIG_ID | PAYLOAD | CRC |

- LEN represents the size of SIG_ID + PAYLOAD
- CRC is calculated over SIG_ID + PAYLOAD

**Full protocol description:** see 'protocol/protocol.md'

## License

The project is licensed under the MIT License.
